aW1wb3J0IHsgQ29tcG9uZW50LCBPbkluaXQgfSBmcm9tICdAYW5ndWxhci9jb3JlJzsKaW1wb3J0IHsgQXBwQ29tcG9uZW50IH0gZnJvbSAnc3JjL2FwcC9hcHAuY29tcG9uZW50JzsKaW1wb3J0IHsgTWFpbkNvbXBvbmVudCB9IGZyb20gJy4uL21haW4uY29tcG9uZW50JzsKCkBDb21wb25lbnQoewogICAgc2VsZWN0b3I6ICdhcHAtY29uZmlnJywKICAgIHRlbXBsYXRlVXJsOiAnLi9jb25maWcuY29tcG9uZW50Lmh0bWwnCn0pCmV4cG9ydCBjbGFzcyBDb25maWdDb21wb25lbnQgaW1wbGVtZW50cyBPbkluaXQgewoKICAgIHNwZWNpYWxUaGVtZXM6IGFueVtdPVtdOwoKICAgIHRoZW1lczogYW55W109W107CgogICAgY29uc3RydWN0b3IocHVibGljIGFwcE1haW46IE1haW5Db21wb25lbnQsIHB1YmxpYyBhcHA6IEFwcENvbXBvbmVudCkgewogICAgfQoKICAgIG5nT25Jbml0KCkgewogICAgICAgIHRoaXMudGhlbWVzID0gWwogICAgICAgICAgICB7bmFtZTogJ2JsdWUnLCBjb2xvcjogJyMwMDcxYmMnfSwKICAgICAgICAgICAge25hbWU6ICdjeWFuJywgY29sb3I6ICcjMDBiZmU3J30sCiAgICAgICAgICAgIHtuYW1lOiAnZ3JlZW4nLCBjb2xvcjogJyM0QUE1NjQnfSwKICAgICAgICAgICAge25hbWU6ICd5ZWxsb3cnLCBjb2xvcjogJyNGOUM2NDInfSwKICAgICAgICAgICAge25hbWU6ICdwdXJwbGUnLCBjb2xvcjogJyM2QTRBQTUnfSwKICAgICAgICAgICAge25hbWU6ICdwaW5rJywgY29sb3I6ICcjOWY0NDg4J30sCiAgICAgICAgICAgIHtuYW1lOiAnYmx1ZWdyZXknLCBjb2xvcjogJyM0QjZEN0UnfSwKICAgICAgICAgICAge25hbWU6ICd0ZWFsJywgY29sb3I6ICcjMDdBMDg5J30sCiAgICAgICAgICAgIHtuYW1lOiAnb3JhbmdlJywgY29sb3I6ICcjZmU4NzVkJ30sCiAgICAgICAgICAgIHtuYW1lOiAnZ3JleScsIGNvbG9yOiAnIzVCNjE2Qid9LAogICAgICAgIF07CgogICAgICAgIHRoaXMuc3BlY2lhbFRoZW1lcyA9IFsKICAgICAgICAgICAge25hbWU6ICdjYXBwdWNjaW5vJywgaW1hZ2U6ICdjYXBwdWNjaW5vJ30sCiAgICAgICAgICAgIHtuYW1lOiAnbW9udHJlYWwnLCBpbWFnZTogJ21vbnRyZWFsJ30sCiAgICAgICAgICAgIHtuYW1lOiAnaG9sbHl3b29kJywgaW1hZ2U6ICdob2xseXdvb2QnfSwKICAgICAgICAgICAge25hbWU6ICdwZWFrJywgaW1hZ2U6ICdwZWFrJ30sCiAgICAgICAgICAgIHtuYW1lOiAnYWxpdmUnLCBjb2xvcjE6ICcjQ0IzNTZCJywgY29sb3IyOiAnI0JEM0YzMid9LAogICAgICAgICAgICB7bmFtZTogJ2VtZXJhbGQnLCBjb2xvcjE6ICcjMzQ4RjUwJywgY29sb3IyOiAnIzU2QjREMyd9LAogICAgICAgICAgICB7bmFtZTogJ2FzaCcsIGNvbG9yMTogJyM2MDZjODgnLCBjb2xvcjI6ICcjM2Y0YzZiJ30sCiAgICAgICAgICAgIHtuYW1lOiAnbm9pcicsIGNvbG9yMTogJyM0YjZjYjcnLCBjb2xvcjI6ICcjMTgyODQ4J30sCiAgICAgICAgICAgIHtuYW1lOiAnbWFudGxlJywgY29sb3IxOiAnIzUxNEE5RCcsIGNvbG9yMjogJyMyNEM2REMnfSwKICAgICAgICAgICAge25hbWU6ICdwcmVkYXduJywgY29sb3IxOiAnIzAwMjIzRScsIGNvbG9yMjogJyNGRkExN0YnfSwKICAgICAgICBdOwogICAgfQoKICAgIGNoYW5nZVRoZW1lKHRoZW1lOiBzdHJpbmcpIHsKICAgICAgICB0aGlzLmFwcC50aGVtZSA9IHRoZW1lOwoKICAgICAgICB0aGlzLmNoYW5nZVN0eWxlU2hlZXRzQ29sb3IoJ3RoZW1lLWNzcycsICd0aGVtZS0nICsgdGhlbWUgKyAnLmNzcycpOwogICAgICAgIHRoaXMuY2hhbmdlU3R5bGVTaGVldHNDb2xvcignbGF5b3V0LWNzcycsICdsYXlvdXQtJyArIHRoZW1lICsgJy5jc3MnKTsKICAgIH0KCiAgICBjaGFuZ2VTdHlsZVNoZWV0c0NvbG9yKGlkOmFueSwgdmFsdWU6YW55KSB7CiAgICAgICAgY29uc3QgZWxlbWVudCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGlkKTsKICAgICAgICBjb25zdCBocmVmQXR0cjphbnk9ZWxlbWVudD8uZ2V0QXR0cmlidXRlKCdocmVmJyk7CiAgICAgICAgaWYoaHJlZkF0dHIpewogICAgICAgICAgICBjb25zdCB1cmxUb2tlbnMgPSBocmVmQXR0ci5zcGxpdCgnLycpOwogICAgICAgICAgICB1cmxUb2tlbnNbdXJsVG9rZW5zLmxlbmd0aCAtIDFdID0gdmFsdWU7CgogICAgICAgICAgICBjb25zdCBuZXdVUkwgPSB1cmxUb2tlbnMuam9pbignLycpOwoKICAgICAgICAgICAgdGhpcy5yZXBsYWNlTGluayhlbGVtZW50LCBuZXdVUkwpOwogICAgICAgIH0KICAgIH0KCiAgICBpc0lFKCkgewogICAgICAgIHJldHVybiAvKE1TSUV8VHJpZGVudFwvfEVkZ2VcLykvaS50ZXN0KHdpbmRvdy5uYXZpZ2F0b3IudXNlckFnZW50KTsKICAgIH0KCiAgICByZXBsYWNlTGluayhsaW5rRWxlbWVudDphbnksIGhyZWY6YW55KSB7CiAgICAgICAgaWYgKHRoaXMuaXNJRSgpKSB7CiAgICAgICAgICAgIGxpbmtFbGVtZW50LnNldEF0dHJpYnV0ZSgnaHJlZicsIGhyZWYpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIGNvbnN0IGlkID0gbGlua0VsZW1lbnQuZ2V0QXR0cmlidXRlKCdpZCcpOwogICAgICAgICAgICBjb25zdCBjbG9uZUxpbmtFbGVtZW50ID0gbGlua0VsZW1lbnQuY2xvbmVOb2RlKHRydWUpOwoKICAgICAgICAgICAgY2xvbmVMaW5rRWxlbWVudC5zZXRBdHRyaWJ1dGUoJ2hyZWYnLCBocmVmKTsKICAgICAgICAgICAgY2xvbmVMaW5rRWxlbWVudC5zZXRBdHRyaWJ1dGUoJ2lkJywgaWQgKyAnLWNsb25lJyk7CgogICAgICAgICAgICBsaW5rRWxlbWVudC5wYXJlbnROb2RlLmluc2VydEJlZm9yZShjbG9uZUxpbmtFbGVtZW50LCBsaW5rRWxlbWVudC5uZXh0U2libGluZyk7CgogICAgICAgICAgICBjbG9uZUxpbmtFbGVtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ2xvYWQnLCAoKSA9PiB7CiAgICAgICAgICAgICAgICBsaW5rRWxlbWVudC5yZW1vdmUoKTsKICAgICAgICAgICAgICAgIGNsb25lTGlua0VsZW1lbnQuc2V0QXR0cmlidXRlKCdpZCcsIGlkKTsKICAgICAgICAgICAgfSk7CiAgICAgICAgfQogICAgfQoKICAgIG9uQ29uZmlnQnV0dG9uQ2xpY2soZXZlbnQ6YW55KSB7CiAgICAgICAgdGhpcy5hcHBNYWluLmNvbmZpZ0FjdGl2ZSA9ICF0aGlzLmFwcE1haW4uY29uZmlnQWN0aXZlOwogICAgICAgIHRoaXMuYXBwTWFpbi5jb25maWdDbGljayA9IHRydWU7CiAgICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTsKICAgIH0KfQo