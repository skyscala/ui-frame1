aW1wb3J0IHsgVGVzdEJlZCB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUvdGVzdGluZyc7CmltcG9ydCB7IFJvdXRlclRlc3RpbmdNb2R1bGUgfSBmcm9tICdAYW5ndWxhci9yb3V0ZXIvdGVzdGluZyc7CmltcG9ydCB7IEFwcENvbXBvbmVudCB9IGZyb20gJy4vYXBwLmNvbXBvbmVudCc7CgpkZXNjcmliZSgnQXBwQ29tcG9uZW50JywgKCkgPT4gewogIGJlZm9yZUVhY2goYXN5bmMgKCkgPT4gewogICAgYXdhaXQgVGVzdEJlZC5jb25maWd1cmVUZXN0aW5nTW9kdWxlKHsKICAgICAgaW1wb3J0czogWwogICAgICAgIFJvdXRlclRlc3RpbmdNb2R1bGUKICAgICAgXSwKICAgICAgZGVjbGFyYXRpb25zOiBbCiAgICAgICAgQXBwQ29tcG9uZW50CiAgICAgIF0sCiAgICB9KS5jb21waWxlQ29tcG9uZW50cygpOwogIH0pOwoKICBpdCgnc2hvdWxkIGNyZWF0ZSB0aGUgYXBwJywgKCkgPT4gewogICAgY29uc3QgZml4dHVyZSA9IFRlc3RCZWQuY3JlYXRlQ29tcG9uZW50KEFwcENvbXBvbmVudCk7CiAgICBjb25zdCBhcHAgPSBmaXh0dXJlLmNvbXBvbmVudEluc3RhbmNlOwogICAgZXhwZWN0KGFwcCkudG9CZVRydXRoeSgpOwogIH0pOwoKICBpdChgc2hvdWxkIGhhdmUgYXMgdGl0bGUgJ2FkbWluLWNvbnNvbGUtcHJpbWVuZydgLCAoKSA9PiB7CiAgICBjb25zdCBmaXh0dXJlID0gVGVzdEJlZC5jcmVhdGVDb21wb25lbnQoQXBwQ29tcG9uZW50KTsKICAgIGNvbnN0IGFwcCA9IGZpeHR1cmUuY29tcG9uZW50SW5zdGFuY2U7CiAgICBleHBlY3QoYXBwLnRpdGxlKS50b0VxdWFsKCdhZG1pbi1jb25zb2xlLXByaW1lbmcnKTsKICB9KTsKCiAgaXQoJ3Nob3VsZCByZW5kZXIgdGl0bGUnLCAoKSA9PiB7CiAgICBjb25zdCBmaXh0dXJlID0gVGVzdEJlZC5jcmVhdGVDb21wb25lbnQoQXBwQ29tcG9uZW50KTsKICAgIGZpeHR1cmUuZGV0ZWN0Q2hhbmdlcygpOwogICAgY29uc3QgY29tcGlsZWQgPSBmaXh0dXJlLm5hdGl2ZUVsZW1lbnQgYXMgSFRNTEVsZW1lbnQ7CiAgICBleHBlY3QoY29tcGlsZWQucXVlcnlTZWxlY3RvcignLmNvbnRlbnQgc3BhbicpPy50ZXh0Q29udGVudCkudG9Db250YWluKCdhZG1pbi1jb25zb2xlLXByaW1lbmcgYXBwIGlzIHJ1bm5pbmchJyk7CiAgfSk7Cn0pOwo